<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>レストラン検索</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-white">

<div class="container mt-5">
    <div class="card bg-secondary text-dark p-4 mx-auto" style="max-width: 700px;">
        <h1 class="text-center mb-4">レストラン検索</h1>

        <form action="/search" method="post">
            <!-- エリア選択 -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">地方エリア</label>
                    <select id="large_area" name="large_area" class="form-select">
                        <option value="">選択してください</option>
                        <option value="Z011">北海道</option>
                        <option value="Z021">東北</option>
                        <option value="Z041">甲信越</option>
                        <option value="Z051">北陸</option>
                        <option value="Z061">東海</option>
                        <option value="Z071">関西</option>
                        <option value="Z081">中国</option>
                        <option value="Z091">四国</option>
                        <option value="Z101">九州</option>
                        <option value="Z111">沖縄</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">都道府県</label>
                    <select id="pref_area" name="pref_area" class="form-select">
                        <option value="">選択してください</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">市区エリア</label>
                    <select id="middle_area" name="middle_area" class="form-select">
                        <option value="">選択してください</option>
                    </select>
                </div>
            </div>

            <!-- キーワード -->
            <div class="mb-3">
                <label class="form-label">キーワード</label>
                <input type="text" name="keyword" class="form-control" placeholder="例: カフェ、ラーメン など">
            </div>

            <!-- 緯度・経度（自動取得） -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">緯度</label>
                    <input type="text" name="lat" id="lat" class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">経度</label>
                    <input type="text" name="lng" id="lng" class="form-control">
                </div>
            </div>

            <!-- 検索範囲 -->
            <div class="mb-3">
                <label class="form-label">検索半径</label>
                <select name="range" class="form-select">
                    <option value="1">300m</option>
                    <option value="2">500m</option>
                    <option value="3">1000m</option>
                    <option value="4">2000m</option>
                    <option value="5">3000m</option>
                </select>
            </div>

            <!-- 検索ボタン -->
            <div class="text-center">
                <button type="submit" class="btn btn-light btn-lg px-5">検索する</button>
            </div>
        </form>
    </div>
</div>

<!-- スクリプト部分 -->
<script>
const areaData = {
  "Z011": { "北海道": [{ label: "札幌駅周辺", value: "Y010" }, { label: "大通", value: "Y011" }] },
  "Z021": { "宮城": [{ label: "仙台駅周辺", value: "Y050" }], "福島": [{ label: "郡山", value: "Y054" }] },
  "Z041": { "新潟": [{ label: "新潟駅周辺", value: "Y060" }], "長野": [{ label: "長野駅周辺", value: "Y061" }] },
  "Z051": { "石川": [{ label: "金沢", value: "Y070" }], "富山": [{ label: "富山駅周辺", value: "Y071" }] },
  "Z061": { "愛知": [{ label: "名古屋駅周辺", value: "Y080" }], "静岡": [{ label: "静岡駅周辺", value: "Y081" }] },
  "Z071": { "大阪": [{ label: "梅田", value: "Y980" }, { label: "なんば", value: "Y981" }], "京都": [{ label: "京都駅", value: "Y982" }], "兵庫": [{ label: "三宮", value: "Y983" }] },
  "Z081": { "広島": [{ label: "八丁堀・紙屋町", value: "Y100" }], "岡山": [{ label: "岡山駅", value: "Y101" }] },
  "Z091": { "香川": [{ label: "高松", value: "Y086" }], "愛媛": [{ label: "松山", value: "Y087" }] },
  "Z101": { "福岡": [{ label: "天神", value: "Y083" }, { label: "博多", value: "Y084" }], "熊本": [{ label: "熊本市中心", value: "Y085" }] },
  "Z111": { "沖縄": [{ label: "那覇", value: "Y120" }] }
};

const largeAreaSelect = document.getElementById("large_area");
const prefAreaSelect = document.getElementById("pref_area");
const middleAreaSelect = document.getElementById("middle_area");
const latInput = document.getElementById("lat");
const lngInput = document.getElementById("lng");
const form = document.querySelector("form");

// 地方選択時 → 都道府県リスト切り替え
largeAreaSelect.addEventListener("change", function () {
    const selected = this.value;
    prefAreaSelect.innerHTML = '<option value="">選択してください</option>';
    middleAreaSelect.innerHTML = '<option value="">選択してください</option>';
    enableGeo();
    if (areaData[selected]) {
        Object.keys(areaData[selected]).forEach(pref => {
            const option = document.createElement("option");
            option.value = pref;
            option.textContent = pref;
            prefAreaSelect.appendChild(option);
        });
    }
});

// 都道府県選択時 → 市区リスト切り替え
prefAreaSelect.addEventListener("change", function () {
    const large = largeAreaSelect.value;
    const pref = this.value;
    middleAreaSelect.innerHTML = '<option value="">選択してください</option>';
    enableGeo();
    if (areaData[large] && areaData[large][pref]) {
        areaData[large][pref].forEach(area => {
            const option = document.createElement("option");
            option.value = area.value;
            option.textContent = area.label;
            middleAreaSelect.appendChild(option);
        });
    }
});

// 市区選択時 → 緯度・経度無効化
middleAreaSelect.addEventListener("change", function () {
    if (this.value) {
        latInput.disabled = true;
        lngInput.disabled = true;
    } else {
        enableGeo();
    }
});

// 現在地取得（初回）
navigator.geolocation.getCurrentPosition(function (position) {
    latInput.value = position.coords.latitude;
    lngInput.value = position.coords.longitude;
});

// フォーム送信時チェック
form.addEventListener("submit", function (e) {
    if (!middleAreaSelect.value && (!latInput.value || !lngInput.value)) {
        e.preventDefault();
        alert("市区エリアを選択するか、位置情報を有効にしてください。");
    }
});

// 緯度・経度を有効に戻す
function enableGeo() {
    latInput.disabled = false;
    lngInput.disabled = false;
}
</script>

</body>
</html>
